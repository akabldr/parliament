<body>
如何实现一个高可用的分布式key-value存储服务。
<h3>目标</h3>
<blockquote>A distributed system is one in which the failure of a computer you didn't even know existed can render your
    own computer unusable. 由于某台你不知道其存在的电脑的失败，导致你自己电脑无法使用的某种系统，就是分布式系统。- Lamport
</blockquote>
为什么存在分布式系统？原因可能有：
<ul>
    <li>一台电脑无法完成我们功能，比如性能或容量限制。</li>
    <li>需要别人的系统配合自己完成工作。</li>
    <li>单机失败概率太高，我们需要容灾，保证高可用。</li>
</ul>
我们这里的kv服务器主要目标是第三个——高可用。这涉及到一些分布式理论，但是这里不会讲解，读者可以自己查看相关资料。
<p>
    本文档和项目的目的是通过一个kv服务java实现的例子，让读者对分布式系统设计和实现的挑战有一个初步认识。
</p>
<p>
    虽然本人尽量以生产环境的可靠性、正确性来实现这个kv服务，但精力、能力有限，某些细节会比较粗糙，可能有bug，并且不会提供相关运维工具的设计和实现。读者可以自己补充、完善，进行各种测试、试验。
</p>

<h3>构建及运行</h3>
<p>
    使用maven 3、jdk9或更新版本进行构建，
    如果你要使用IDE查看代码，请安装<a href="https://projectlombok.org/setup/overview">lombok插件</a>
</p>

<h3>运行</h3>
在target编译目录下，启动服务器1：
<pre>
java -Dkv="127.0.0.1:7000" -Dme="127.0.0.1:8001" -Dpeers="127.0.0.1:8000,127.0.0.1:8001,127.0.0.1:8002" -Ddir="./db7000" -cp .\dependencies\ -jar .\parliament-1.0-SNAPSHOT.jar
</pre>
服务器2:
<pre>
java -Dkv="127.0.0.1:7001" -Dme="127.0.0.1:8002" -Dpeers="127.0.0.1:8000,127.0.0.1:8001,127.0.0.1:8002" -Ddir="./db70001" -cp .\dependencies\ -jar .\parliament-1.0-SNAPSHOT.jar
</pre>
使用redis-cli客户端，连接各个服务:
<pre>
redis-cli 127.0.0.1:7001
</pre>
目前实现了get\put\del\range命令：
<pre>
put a A
get a
del a
range a z
</pre>

<h3>实现过程</h3>
<ol>
    <li>接收kv客户端请求：{@link io.github.parliament.kv.KeyValueServer}</li>
    <li>处理RESP协议报文：{@link io.github.parliament.resp.RespHandlerAttachment}</li>
    <li>执行kv命令：{@link io.github.parliament.kv.KeyValueEngine}</li>
    <li>实现复制状态机：{@link io.github.parliament.ReplicateStateMachine}</li>
    <li>实现paxos算法：{@link io.github.parliament.paxos.Paxos}</li>
    <li>实现paxos网络接口服务端：{@link io.github.parliament.paxos.server.PaxosServer}</li>
    <li>实现paxos网络接口客户端：{@link io.github.parliament.paxos.client.InetPeerAcceptors}</li>
    <li>实现存储：{@link io.github.parliament.skiplist.SkipList}</li>
</ol>

<h4>读者挑战</h4>
以下是本项目未提供，但是读者可以挑战的功能。
<ol>
    <li>尽可能的提高系统并发并行能力。</li>
    <li>实现写前日志，保证单机宕机后的自动恢复。</li>
    <li>实现保证多个命令同时成功或回滚的事务机制。</li>
</ol>
</body>
